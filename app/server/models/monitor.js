var Db = require('mongodb').Db;
var server = require('mongodb').Server;

var PropertiesReader = require('properties-reader');
var properties = PropertiesReader('./kyrosview.properties');

// Definici√≥n del log
var fs = require('fs');
var log = require('tracer').console({
    transport : function(data) {
        //console.log(data.output);
        fs.open(properties.get('main.log.file'), 'a', 0666, function(e, id) {
            fs.write(id, data.output+"\n", null, 'utf8', function() {
                fs.close(id, function() {
                });
            });
        });
    }
});

var dbMongoName = properties.get('bbdd.mongo.name');
var dbMongoHost = properties.get('bbdd.mongo.ip');
var dbMongoPort = properties.get('bbdd.mongo.port');

var db = new Db(dbMongoName, new server(dbMongoHost, dbMongoPort));


// Crear un objeto para ir almacenando todo lo necesario
var monitorModel = {};

monitorModel.getMonitorFromUser = function(username,callback)
{
  db.open(function(err, db) {
    if(err) {
        callback(err, null);
    }
    else {
        var collection = db.collection('deviceMonitor');
        //var tempdoc = [{"childs": [{ "type": "device", "id": 119, "name": "DemoKyros"}, { "type": "device", "id": 74, "name": "Bike_rohm"}, { "type": "device", "id": 73, "name": "Bici_Rohm"}, { "type": "device", "id": 202, "name": "Nomo_Rohm"}, { "type": "device", "id": 144, "name": "GL200_cx"}, { "type": "device", "id": 460, "name": "T16_864768010019054"}, { "type": "device", "id": 461, "name": "001"}, { "type": "device", "id": 462, "name": "002"}, { "type": "device", "id": 631, "name": "VT30_9799"}, { "type": "device", "id": 433, "name": "TT1_Rohm"}, { "type": "device", "id": 559, "name": "VT10TT1"}, { "type": "device", "id": 150, "name": "GT303B"}, { "type": "device", "id": 643, "name": "Elfo_01"}, { "type": "device", "id": 491, "name": "Bike_Roberto"}, { "type": "device", "id": 647, "name": "4852BJS"}, { "type": "device", "id": 87, "name": "CANBUS_Rohm"}, { "type": "device", "id": 404, "name": "S_rohm"}, { "type": "device", "id": 4, "name": "0554GRV"}], "type": "fleet", "id": 89, "name": "Roberto"}, {"childs": [{ "type": "device", "id": 655, "name": "FLAA-RUNKEEPER"}], "type": "fleet", "id": 571, "name": "Felisa Ares"}, {"childs": [{ "type": "device", "id": 488, "name": "dcargoTT_amelendez"}, { "type": "device", "id": 502, "name": "3505HPY"}, { "type": "device", "id": 492, "name": "Android-almt"}], "type": "fleet", "id": 531, "name": "Alvaro Melendez"}, {"childs": [{ "type": "device", "id": 457, "name": "Xperia_DAAG"}, { "type": "device", "id": 544, "name": "Ranger"}, { "type": "device", "id": 561, "name": "GalaxyS6"}, { "type": "device", "id": 62, "name": "Android_David"}], "type": "fleet", "id": 532, "name": "David"}, {"childs": [{ "type": "device", "id": 498, "name": "DMUK-1"}, { "type": "device", "id": 499, "name": "DMUK-2"}, { "type": "device", "id": 500, "name": "DMUK-3"}], "type": "fleet", "id": 533, "name": "DeimosUK"}, {"childs": [{ "type": "device", "id": 496, "name": "HW_2242"}, { "type": "device", "id": 497, "name": "HW_2179"}, { "type": "device", "id": 227, "name": "dCargo_TT_Portatil"}], "type": "fleet", "id": 535, "name": "ELECNOR HAWKEYE"}, {"childs": [{ "type": "device", "id": 485, "name": "iFall_carm"}, { "type": "device", "id": 489, "name": "iFall_rohm"}], "type": "fleet", "id": 537, "name": "IFALL"}, {"childs": [{ "type": "device", "id": 503, "name": "TRACK_NEPAL"}], "type": "fleet", "id": 538, "name": "NEPAL"}, {"childs": [{ "type": "device", "id": 519, "name": "3042548029"}, { "type": "device", "id": 521, "name": "3042505011"}, { "type": "device", "id": 522, "name": "3042539853"}, { "type": "device", "id": 526, "name": "3042505680"}, { "type": "device", "id": 529, "name": "3042584248"}, { "type": "device", "id": 538, "name": "3042508320"}, { "type": "device", "id": 547, "name": "3042507918"}, { "type": "device", "id": 552, "name": "3042506902"}, { "type": "device", "id": 553, "name": "3042507199"}, { "type": "device", "id": 571, "name": "3042622071"}, { "type": "device", "id": 574, "name": "3047799229"}], "type": "fleet", "id": 543, "name": "M7_Refurbished_OCU"}, {"childs": [{ "type": "device", "id": 564, "name": "GENERALI_01"}, { "type": "device", "id": 565, "name": "GENERALI_02"}, { "type": "device", "id": 614, "name": "GENERALI_05"}, { "type": "device", "id": 612, "name": "GENERALI_03"}, { "type": "device", "id": 613, "name": "GENERALI_04"}, { "type": "device", "id": 615, "name": "GENERALI_06"}, { "type": "device", "id": 616, "name": "GENERALI_07"}, { "type": "device", "id": 617, "name": "GENERALI_08"}, { "type": "device", "id": 618, "name": "GENERALI_09"}, { "type": "device", "id": 619, "name": "GENERALI_10"}, { "type": "device", "id": 620, "name": "GENERALI_11"}, { "type": "device", "id": 621, "name": "GENERALI_12"}, { "type": "device", "id": 562, "name": "GENERALI_Galaxy_FLAA"}], "type": "fleet", "id": 545, "name": "GENERALI_VODAFONE"}, {"childs": [{ "type": "device", "id": 163, "name": "JIMI_0741068"}, { "type": "device", "id": 108, "name": "dbuque"}, { "type": "device", "id": 109, "name": "dbuque_02"}, { "type": "device", "id": 603, "name": "Eduard_Stiven"}], "type": "fleet", "id": 546, "name": "OLD_DEVICES"}, { "type": "fleet", "id": 547, "name": "JOBR"}, {"childs": [{ "type": "device", "id": 581, "name": "3042542428"}, { "type": "device", "id": 580, "name": "3042544374"}, { "type": "device", "id": 578, "name": "3042547500"}, { "type": "device", "id": 577, "name": "3042549159"}, { "type": "device", "id": 576, "name": "3042619762"}, { "type": "device", "id": 579, "name": "3042620620"}, { "type": "device", "id": 592, "name": "3042508072"}, { "type": "device", "id": 591, "name": "3042593900"}, { "type": "device", "id": 593, "name": "3047905602"}, { "type": "device", "id": 543, "name": "3042539671"}, { "type": "device", "id": 548, "name": "3042584735"}, { "type": "device", "id": 532, "name": "3042588447"}], "type": "fleet", "id": 551, "name": "M7_Refurbished"}, {"childs": [{ "type": "device", "id": 589, "name": "3042613732"}, { "type": "device", "id": 587, "name": "3047830867"}, { "type": "device", "id": 585, "name": "3047859981"}, { "type": "device", "id": 588, "name": "3047904316"}], "type": "fleet", "id": 552, "name": "CORREOS_dCARGO_TT"}, {"childs": [{ "type": "device", "id": 520, "name": "TV_03B"}, { "type": "device", "id": 539, "name": "TV_04A"}, { "type": "device", "id": 523, "name": "TV_04B"}, { "type": "device", "id": 517, "name": "TV_03A"}, { "type": "device", "id": 527, "name": "FRIDGE_03"}, { "type": "device", "id": 518, "name": "FRIDGE_04"}, { "type": "device", "id": 536, "name": "FRIDGE_02"}, { "type": "device", "id": 540, "name": "CPU_02"}, { "type": "device", "id": 511, "name": "CPU_01"}, { "type": "device", "id": 530, "name": "CPU_03"}, { "type": "device", "id": 573, "name": "CPU_04"}, { "type": "device", "id": 531, "name": "WASHMACHINE_02"}, { "type": "device", "id": 535, "name": "WASHMACHINE_01"}, { "type": "device", "id": 524, "name": "WASHMACHINE_03"}, { "type": "device", "id": 537, "name": "TV_01A"}, { "type": "device", "id": 533, "name": "TV_01B"}, { "type": "device", "id": 582, "name": "TV_02A"}, { "type": "device", "id": 583, "name": "TV_02B"}, { "type": "device", "id": 599, "name": "FRIDGE_01"}, { "type": "device", "id": 600, "name": "WASHMACHINE_04"}], "type": "fleet", "id": 553, "name": "OCU Belgica 2016"}, {"childs": [{ "type": "device", "id": 610, "name": "SPX054"}], "type": "fleet", "id": 554, "name": "ENTRE CAMINOS"}, {"childs": [{ "type": "device", "id": 634, "name": "PILOTO_CORREOS_006"}, { "type": "device", "id": 635, "name": "PILOTO_CORREOS_009"}, { "type": "device", "id": 633, "name": "TT1_002_Correos"}, { "type": "device", "id": 632, "name": "TT1_001_Correos"}, { "type": "device", "id": 606, "name": "VT_360_01"}, { "type": "device", "id": 608, "name": "VT_360_02"}], "type": "fleet", "id": 555, "name": "CORREOS_Piloto"}, {"childs": [{ "type": "device", "id": 550, "name": "3042618475"}, { "type": "device", "id": 549, "name": "3047847754"}, { "type": "device", "id": 542, "name": "3047905727"}, { "type": "device", "id": 551, "name": "3047764850"}, { "type": "device", "id": 546, "name": "3047869741"}, { "type": "device", "id": 528, "name": "3042588629"}, { "type": "device", "id": 525, "name": "3042590229"}, { "type": "device", "id": 541, "name": "3042590880"}, { "type": "device", "id": 514, "name": "3042595681"}, { "type": "device", "id": 513, "name": "3042547542"}, { "type": "device", "id": 570, "name": "3042539663"}, { "type": "device", "id": 575, "name": "3042622105"}], "type": "fleet", "id": 561, "name": "M7_BRASIL"}, {"childs": [{ "type": "device", "id": 640, "name": "AUTOBUS_CR_01"}, { "type": "device", "id": 641, "name": "AUTOBUS_CR_02"}], "type": "fleet", "id": 562, "name": "Autobuses CR"}, {"childs": [{ "type": "device", "id": 474, "name": "2242"}, { "type": "device", "id": 475, "name": "2179"}], "type": "fleet", "id": 528, "name": "HAWKEYE"}, {"childs": [{ "type": "device", "id": 470, "name": "9870JBZ"}], "type": "fleet", "id": 526, "name": "M. Lizondo"}, {"childs": [{ "type": "device", "id": 411, "name": "TagObjetos1"}, { "type": "device", "id": 412, "name": "TagObjetos2"}, { "type": "device", "id": 428, "name": "TarjetaRF1"}, { "type": "device", "id": 429, "name": "TarjetaRF2"}, { "type": "device", "id": 430, "name": "TarjetaRF3"}, { "type": "device", "id": 431, "name": "TarjetaRF4"}, { "type": "device", "id": 413, "name": "TagPulsador1"}, { "type": "device", "id": 414, "name": "TagPulsador2"}], "type": "fleet", "id": 392, "name": "PERSONAL DMS (inactivos)"}, {"childs": [{ "type": "device", "id": 410, "name": "Tag4"}, { "type": "device", "id": 408, "name": "Tag2"}, { "type": "device", "id": 407, "name": "Tag1"}, { "type": "device", "id": 415, "name": "TagPulsera1"}, { "type": "device", "id": 416, "name": "TagPulsera2"}, { "type": "device", "id": 417, "name": "TagPulsera3"}, { "type": "device", "id": 409, "name": "Tag3"}], "type": "fleet", "id": 386, "name": "PERSONAL DMS (Activos)"}, {"childs": [{ "type": "device", "id": 61, "name": "Android_CL_22"}, { "type": "device", "id": 198, "name": "NANO"}, { "type": "device", "id": 156, "name": "IRIDIUM_01"}, { "type": "device", "id": 157, "name": "IRIDIUM_02"}, { "type": "device", "id": 158, "name": "IRIDIUM_03"}, { "type": "device", "id": 159, "name": "IRIDIUM_04"}, { "type": "device", "id": 160, "name": "IRIDIUM_05"}, { "type": "device", "id": 161, "name": "IRIDIUM_06"}, { "type": "device", "id": 191, "name": "MyTraQ_FLAA_CH"}, { "type": "device", "id": 9, "name": "123456"}, { "type": "device", "id": 186, "name": "MK1101"}, { "type": "device", "id": 187, "name": "MK1102"}, { "type": "device", "id": 85, "name": "CANBUS_DEIMOS"}, { "type": "device", "id": 177, "name": "LD-99-49-CT"}], "type": "fleet", "id": 377, "name": "DAT Demos"}, {"childs": [{ "type": "device", "id": 154, "name": "GT7783-10"}, { "type": "device", "id": 145, "name": "GN4729-10"}, { "type": "device", "id": 142, "name": "GE1505-10"}, { "type": "device", "id": 141, "name": "GC9425-11"}, { "type": "device", "id": 175, "name": "LD-99-31-CT"}, { "type": "device", "id": 147, "name": "GS8772-10"}, { "type": "device", "id": 545, "name": "THURAYA_01"}], "type": "fleet", "id": 365, "name": "DEMOS"}, {"childs": [{ "type": "device", "id": 421, "name": "TagRF3"}, { "type": "device", "id": 419, "name": "TagRF1+GPS"}, { "type": "device", "id": 420, "name": "TagRF2"}, { "type": "device", "id": 426, "name": "TagRF_Pulsera1"}, { "type": "device", "id": 422, "name": "TagRF4"}, { "type": "device", "id": 423, "name": "TagRF5"}, { "type": "device", "id": 424, "name": "TagRF6_Pulsador"}, { "type": "device", "id": 418, "name": "TagRF-IR_50949"}, { "type": "device", "id": 427, "name": "Tag_RF_2s-10s_Pul_144946"}, { "type": "device", "id": 425, "name": "TagRF_IR_77531"}, { "type": "device", "id": 458, "name": "ZigBee1"}, { "type": "device", "id": 459, "name": "ZigBee2"}, { "type": "device", "id": 10, "name": "144945"}, { "type": "device", "id": 12, "name": "144974"}, { "type": "device", "id": 52, "name": "90096"}, { "type": "device", "id": 43, "name": "66376"}, { "type": "device", "id": 11, "name": "144973"}, { "type": "device", "id": 33, "name": "56763"}, { "type": "device", "id": 2, "name": "00144972"}, { "type": "device", "id": 190, "name": "MYTRAQ_DEBUG"}], "type": "fleet", "id": 351, "name": "PERSONAL DAT"}, {"childs": [{ "type": "device", "id": 13, "name": "1615-FDW"}, { "type": "device", "id": 59, "name": "Android_Carlos"}, { "type": "device", "id": 651, "name": "CARM-BIKE"}, { "type": "device", "id": 653, "name": "CARM-RUNNING"}, {"childs": [{ "type": "fleet", "id": 577, "name": "carm11"}], "type": "fleet", "id": 575, "name": "carm1"}], "type": "fleet", "id": 345, "name": "Carlos Rueda"}, {"childs": [{ "type": "device", "id": 82, "name": "Camel004"}, { "type": "device", "id": 126, "name": "ELN_SEGURIDAD_04"}], "type": "fleet", "id": 126, "name": "LOGISTICA_DEIMOS_SOPORTE"}, {"childs": [{ "type": "device", "id": 120, "name": "DisplayActis7"}, { "type": "device", "id": 197, "name": "NAGIOS"}], "type": "fleet", "id": 15, "name": "Laboratorio"}, {"childs": [{ "type": "device", "id": 183, "name": "MamboSystem"}, { "type": "device", "id": 125, "name": "Elfo_prueb"}, { "type": "device", "id": 447, "name": "VT10-5115"}, { "type": "device", "id": 395, "name": "R190"}, { "type": "device", "id": 451, "name": "VT_300"}, { "type": "device", "id": 450, "name": "VT300"}, { "type": "device", "id": 482, "name": "Mambo_TEST"}, { "type": "device", "id": 483, "name": "Mambo_TEST_2"}, { "type": "device", "id": 567, "name": "josp_mytraq"}, { "type": "device", "id": 396, "name": "R191"}, { "type": "device", "id": 226, "name": "PRUEBAS"}, { "type": "device", "id": 448, "name": "VT10-TRAILER"}, { "type": "device", "id": 201, "name": "Nomo_Perimetraje"}], "type": "fleet", "id": 446, "name": "LOGISTICA_DEIMOS_PRUEBAS"}, {"childs": [{ "type": "device", "id": 630, "name": "3585FRX_CANBUS_Negro"}, { "type": "fleet", "id": 565, "name": "adms Personales"}, { "type": "fleet", "id": 567, "name": "adms Otros"}, { "type": "fleet", "id": 569, "name": "adms Vehiculos"}], "type": "fleet", "id": 462, "name": "A. MONTERO"}, {"childs": [{ "type": "device", "id": 107, "name": "dbike_rohm"}, { "type": "device", "id": 466, "name": "TK06"}, { "type": "device", "id": 405, "name": "T16"}, { "type": "device", "id": 151, "name": "GT304_87556"}, { "type": "device", "id": 468, "name": "MAMBO_SIT"}, { "type": "device", "id": 473, "name": "Brazalete_MT60_1"}, { "type": "device", "id": 476, "name": "Brazalete_MT60_2"}], "type": "fleet", "id": 525, "name": "NUEVOS DISPOSITIVOS"}, {"childs": [{ "type": "device", "id": 51, "name": "7274HMS_backup"}], "type": "fleet", "id": 520, "name": "Elecnor Sur Mantenimiento 533"}, {"childs": [{ "type": "device", "id": 111, "name": "dbusca_BL01"}, { "type": "device", "id": 112, "name": "dbusca_BL02"}], "type": "fleet", "id": 516, "name": "PCI"}, {"childs": [{ "type": "device", "id": 32, "name": "5542165814"}, { "type": "device", "id": 27, "name": "5515232318"}, { "type": "device", "id": 30, "name": "5538345472"}, { "type": "device", "id": 31, "name": "5538510090"}, { "type": "device", "id": 19, "name": "3311250786"}, { "type": "device", "id": 17, "name": "3311250628"}, { "type": "device", "id": 18, "name": "3311250781"}, { "type": "device", "id": 28, "name": "5520459899"}, { "type": "device", "id": 29, "name": "5528216722"}], "type": "fleet", "id": 505, "name": "INDRA MEXICO"}, {"childs": [{ "type": "device", "id": 167, "name": "L10837"}, { "type": "device", "id": 166, "name": "L004428"}, { "type": "device", "id": 178, "name": "M06130"}, { "type": "device", "id": 179, "name": "M2198"}, { "type": "device", "id": 180, "name": "M2319"}, { "type": "device", "id": 456, "name": "X2630"}], "type": "fleet", "id": 500, "name": "DEMO TAXIS"}, {"childs": [{ "type": "device", "id": 114, "name": "dbusca_MB_Vims"}, { "type": "device", "id": 623, "name": "Nomo_150"}, { "type": "device", "id": 56, "name": "Android-Mjar"}, { "type": "device", "id": 189, "name": "Nomo_MAJO"}], "type": "fleet", "id": 495, "name": "DEMO personales "}, {"childs": [{ "type": "device", "id": 16, "name": "3047904514"}, { "type": "device", "id": 512, "name": "3042584933"}, { "type": "device", "id": 572, "name": "3042620794"}, { "type": "device", "id": 594, "name": "3042587548"}, { "type": "device", "id": 601, "name": "3042621644"}, { "type": "device", "id": 515, "name": "3042584883"}], "type": "fleet", "id": 485, "name": "M7_dCARGO_TT RMA"}, {"childs": [{ "type": "device", "id": 584, "name": "3042593462"}], "type": "fleet", "id": 473, "name": "M7_dCARGO_TT STOCK DEIMOS"}, {"childs": [{ "type": "device", "id": 24, "name": "359921053797233"}, { "type": "device", "id": 590, "name": "PRUEBA"}, { "type": "device", "id": 649, "name": "DPER"}], "type": "fleet", "id": 517, "name": "Javier"}, {"childs": [{ "type": "device", "id": 6, "name": "0904FMP"}, { "type": "device", "id": 119, "name": "DemoKyros"}, { "type": "device", "id": 141, "name": "GC9425-11"}, { "type": "device", "id": 142, "name": "GE1505-10"}, { "type": "device", "id": 145, "name": "GN4729-10"}, { "type": "device", "id": 147, "name": "GS8772-10"}, { "type": "device", "id": 154, "name": "GT7783-10"}, { "type": "device", "id": 175, "name": "LD-99-31-CT"}, { "type": "device", "id": 446, "name": "VT10_Temperatura"}], "type": "fleet", "id": 459, "name": "CORREOS"}, {"childs": [{ "type": "device", "id": 14, "name": "2338HBX"}, { "type": "device", "id": 176, "name": "LD-99-43-CT"}, { "type": "device", "id": 184, "name": "MATRIX_5400_DCD"}, { "type": "device", "id": 397, "name": "Ranger_9626"}, { "type": "device", "id": 193, "name": "MyTraQ_Range"}, { "type": "device", "id": 148, "name": "GT300_50614"}, { "type": "device", "id": 554, "name": "pt100_1294"}, { "type": "device", "id": 555, "name": "pt100_1922"}, { "type": "device", "id": 556, "name": "PRIME_ONE_5660"}, { "type": "device", "id": 557, "name": "PRIME_ONE_5645"}, { "type": "device", "id": 560, "name": "VT350"}, { "type": "device", "id": 140, "name": "Galaxy_FLAA"}, { "type": "device", "id": 563, "name": "Galaxy_A3_CARM"}, { "type": "device", "id": 569, "name": "Ranger_David"}, { "type": "device", "id": 602, "name": "GT301_EON"}, { "type": "device", "id": 604, "name": "VT350_1"}, { "type": "device", "id": 607, "name": "Prime_8886"}, { "type": "device", "id": 566, "name": "GENERALI_XX"}, { "type": "device", "id": 609, "name": "VT_360_03"}], "type": "fleet", "id": 467, "name": "DEMO LBS"}, {"childs": [{ "type": "device", "id": 55, "name": "Android-JOGH"}], "type": "fleet", "id": 519, "name": "Jogh"}, {"childs": [{ "type": "device", "id": 504, "name": "Mytraq_Cadv"}], "type": "fleet", "id": 539, "name": "Cadv"}, {"childs": [{ "type": "device", "id": 472, "name": "GEKO_Pruebas"}], "type": "fleet", "id": 544, "name": "GEKONAV"}, { "type": "fleet", "id": 559, "name": "Consultoria_53"}, {"childs": [{ "type": "device", "id": 642, "name": "Elfo_02"}], "type": "fleet", "id": 563, "name": "LDA"}, {"childs": [{ "type": "device", "id": 596, "name": "dCargo_Ecoembes"}], "type": "fleet", "id": 573, "name": "Ecoembes"}, {"childs": [{ "type": "device", "id": 80, "name": "Camel001"}, { "type": "device", "id": 81, "name": "Camel003"}, { "type": "device", "id": 83, "name": "Camel006"}, { "type": "device", "id": 221, "name": "PROT_001"}, { "type": "device", "id": 222, "name": "PROT_002"}], "type": "fleet", "id": 452, "name": "ELECNOR IDDE"}, {"childs": [{ "type": "device", "id": 65, "name": "Android_Valencia"}], "type": "fleet", "id": 490, "name": "Elecnor Valencia"}, {"childs": [{ "type": "device", "id": 479, "name": "Android_1"}], "type": "fleet", "id": 529, "name": "Elecnor Brasil"}, {"childs": [{ "type": "device", "id": 44, "name": "669473388"}, { "type": "device", "id": 36, "name": "609985733"}, { "type": "device", "id": 40, "name": "650005919"}, { "type": "device", "id": 45, "name": "676029826"}, { "type": "device", "id": 25, "name": "380631842803"}, { "type": "device", "id": 37, "name": "620813370"}, { "type": "device", "id": 35, "name": "607164904"}, { "type": "device", "id": 42, "name": "654314492"}, { "type": "device", "id": 48, "name": "686357322"}, { "type": "device", "id": 41, "name": "650101138"}, { "type": "device", "id": 46, "name": "682222565"}, { "type": "device", "id": 20, "name": "356319045212556"}, { "type": "device", "id": 47, "name": "683668016"}, { "type": "device", "id": 38, "name": "645876962"}, { "type": "device", "id": 34, "name": "606957937"}, { "type": "device", "id": 39, "name": "648288925"}, { "type": "device", "id": 23, "name": "358922041458467"}, { "type": "device", "id": 49, "name": "699082301"}, { "type": "device", "id": 464, "name": "351515054177300"}, { "type": "device", "id": 558, "name": "628788208"}], "type": "fleet", "id": 509, "name": "INDRA DESPLAZADOS"}, {"childs": [{ "type": "device", "id": 54, "name": "ADAM_CAR_01"}], "type": "fleet", "id": 478, "name": "ADAM_01"}, {"childs": [{ "type": "device", "id": 89, "name": "Cell_Id_Vicente"}, { "type": "device", "id": 115, "name": "dbusca_mini_Vims"}, { "type": "device", "id": 110, "name": "dbuscaBLvims"}, { "type": "device", "id": 467, "name": "GL200_rh"}, { "type": "device", "id": 203, "name": "Nomo_Vims"}, { "type": "device", "id": 58, "name": "Android-vims"}, { "type": "device", "id": 463, "name": "Android-vims_2"}, { "type": "device", "id": 510, "name": "MAMBO2_VIMS"}, { "type": "device", "id": 116, "name": "dcargoTT_Moto"}, { "type": "device", "id": 122, "name": "dtrack_Vt_Vims"}, { "type": "device", "id": 88, "name": "Canbus_vims"}, { "type": "fleet", "id": 493, "name": "Vims Bk"}], "type": "fleet", "id": 381, "name": "Vicente"}, {"childs": [{ "type": "device", "id": 505, "name": "dcargo_TT_Elecnor_RD_Congo"}], "type": "fleet", "id": 540, "name": "Elecnor RD Congo"}, {"childs": [{ "type": "device", "id": 568, "name": "OrangeTrack_735"}, { "type": "device", "id": 605, "name": "Alfonso"}], "type": "fleet", "id": 550, "name": "ORANGE_DEMO"}, { "type": "fleet", "id": 556, "name": "ECUADOR"}, {"childs": [{ "type": "device", "id": 78, "name": "Brazalete_MT100"}, { "type": "device", "id": 624, "name": "Violencia_Genero_BK"}, { "type": "device", "id": 627, "name": "PPL_Violencia de Genero"}, { "type": "device", "id": 79, "name": "Brazalete_MT100_2"}, { "type": "device", "id": 628, "name": "PPL_BAD_GPS"}], "type": "fleet", "id": 557, "name": "ECUADOR BK"}, {"childs": [{ "type": "device", "id": 625, "name": "Violencia_Genero"}, { "type": "device", "id": 629, "name": "PPL_VG"}], "type": "fleet", "id": 558, "name": "GRUPO PRX"}, {"childs": [{ "type": "device", "id": 637, "name": "FOX3-OBDII_01"}, { "type": "device", "id": 638, "name": "FOX3-OBDII_02"}, { "type": "device", "id": 639, "name": "FOX3-OBDII_03"}], "type": "fleet", "id": 560, "name": "NORTHGATE"}];
        //callback(null, tempdoc);
        //collection.find({'monitor': username}).toArray(function(err, docs) {
        collection.find().toArray(function(err, docs) {
            callback(null, docs);
        });
    }
  });
}

//exportamos el objeto para tenerlo disponible en la zona de rutas
module.exports = monitorModel;
